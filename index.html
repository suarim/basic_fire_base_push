<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Push Notifications</title>
</head>
<body>
    <h1>Push Notification Test</h1>
    <button onclick="initNotifications()">Enable Notifications</button>
    <div id="log"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-messaging.js";

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += message + '<br>';
            console.log(message);
        }

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: "",
            measurementId: ""
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        async function initNotifications() {
            try {
                log('Requesting notification permission...');
                const permission = await Notification.requestPermission();

                if (permission !== 'granted') {
                    log('Permission denied ❌');
                    return;
                }

                log('Permission granted ✅');

                // Register Service Worker
                if ('serviceWorker' in navigator) {
                    await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                    log('Service Worker Registered 🚀');
                }

                // Get Firebase Cloud Messaging (FCM) Token
                const token = await getToken(messaging, { vapidKey: "YOUR_VAPID_KEY_HERE" });
                if (token) {
                    log(`FCM Token: ${token}`);
                } else {
                    log('Failed to get FCM token ❌');
                }

                // Handle Foreground Notifications
                onMessage(messaging, (payload) => {
                    log('📩 Notification received: ' + JSON.stringify(payload));
                    alert(`🔔 New Notification: ${payload.notification.title} - ${payload.notification.body}`);
                });

            } catch (error) {
                log('Error: ' + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
